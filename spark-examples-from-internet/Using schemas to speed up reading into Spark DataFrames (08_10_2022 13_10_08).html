<!DOCTYPE html> <html class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers no-applicationcache svg inlinesvg smil svgclippaths" lang=en style><!--
 Page saved with SingleFile 
 url: https://t-redactyl.io/blog/2020/08/using-schemas-to-speed-up-reading-into-spark-dataframes.html 
 saved date: Sat Oct 08 2022 13:10:08 GMT+0800 (Hong Kong Standard Time)
--><!--<![endif]--><meta charset=utf-8>
<title>Using schemas to speed up reading into Spark&nbsp;DataFrames</title>
<meta name=author content="Jodie Burchell">
<meta name=HandheldFriendly content=True>
<meta name=MobileOptimized content=320>
<meta name=viewport content="width=device-width, initial-scale=1">
<meta name=description content="Using schemas to speed up reading into Spark&nbsp;DataFrames written August 24, 2020 in pyspark">
<meta name=keywords content="python, data science, aws, sagemaker, s3, pyspark">
<link rel=canonical href=https://t-redactyl.github.io/blog/2020/08/using-schemas-to-speed-up-reading-into-spark-dataframes.html>
<link href=https://t-redactyl.github.io/feeds/all.atom.xml type=application/atom+xml rel=alternate title="Standard error Full Atom Feed">
<style media="screen, projection">html,body,div,span,h1,h4,p,pre,a,code,img,article,footer,time{margin:0;padding:0;border:0;font:inherit;font-size:100%;vertical-align:baseline}html{line-height:1}a img{border:none}/*! normalize.css v3.0.0 | MIT License | git.io/normalize */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,footer{display:block}a{background:transparent}a:active,a:hover{outline:0}h1{margin:0.67em 0}hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}pre{overflow:auto}*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}*:before,*:after{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html{font-size:62.5%;-webkit-tap-highlight-color:transparent}body{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:14px;line-height:1.42857;color:#333333;background-color:#fff}a{color:#428bca;text-decoration:none}a:hover,a:focus{color:#2a6496;text-decoration:underline}a:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}img{vertical-align:middle}hr{margin-bottom:20px}h1,h4{font-family:inherit;font-weight:500;line-height:1.1;color:inherit}h1{margin-top:20px;margin-bottom:10px}h4{margin-top:10px;margin-bottom:10px}h1{font-size:36px}code,pre{font-family:Menlo,Monaco,Consolas,"Courier New",monospace}code{padding:2px 4px;font-size:90%;color:#c7254e;background-color:#f9f2f4;white-space:nowrap;border-radius:4px}pre{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857;word-break:break-all;word-wrap:break-word;color:#333333;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px}pre code{padding:0;font-size:inherit;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0}.container{margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px}.container:before,.container:after{content:" ";display:table}.container:after{clear:both}@media (min-width:768px){.container{width:750px}}@media (min-width:992px){.container{width:970px}}@media (min-width:1200px){.container{width:1170px}}.row{margin-left:-15px;margin-right:-15px}.row:before,.row:after{content:" ";display:table}.row:after{clear:both}.col-md-1,.col-md-2,.col-md-8{position:relative;min-height:1px;padding-left:15px;padding-right:15px}@media (min-width:992px){.col-md-1,.col-md-2,.col-md-8{float:left}.col-md-1{width:8.33333%}.col-md-2{width:16.66667%}.col-md-8{width:66.66667%}.col-md-offset-2{margin-left:16.66667%}}@-webkit-keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}.pull-right{float:right!important}@-ms-viewport{width:device-width}.her-row{background:#f9f9f9;border-top:1px solid #f2f2f0;border-bottom:1px solid #f2f2f0;padding:12px 0px}.her-row h4{font-style:normal;padding-bottom:12px;font-size:11px;letter-spacing:.1em;color:#b3b3b1}article .meta{color:#b3b3b1;font-size:14px}article .meta a{color:#b3b3b1}.full-single-article{padding-top:30px}.full-single-article p{font-weight:300;font-style:normal;font-size:18px;line-height:1.5;margin:30px 0px}.home-icon{position:fixed;top:10px;left:10px;width:44px;height:44px;z-index:700;background-color:#333332;text-align:center;border:0}.home-icon img{border:none;width:25px;height:25px;margin-top:9px}.social-icon-list a{opacity:0.3}.social-icon-list a:hover{opacity:0.6}.divider-short{display:block;width:14%;margin:50px auto 40px auto;border:0;border-top:1px solid #dededc}.divider-short{margin-top:20px}#footer h4{font-weight:500;margin:0px;padding:6px 0px 0px 0px;text-transform:none}.highlight{background:#ffffff;color:#4d4d4c}.highlight .err{color:#c82829}.highlight .n{color:#4d4d4c}.highlight .o{color:#3e999f}.highlight .p{color:#4d4d4c}.highlight .kc{color:#8959a8}.highlight .kn{color:#3e999f}.highlight .nb{color:#4d4d4c}.highlight .nn{color:#eab700}.highlight .s2{color:#718c00}.highlight .si{color:#f5871f}.highlight .s1{color:#718c00}</style>
<link href="data:image/png;base64,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" rel=icon><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
 <body>
 <a href=https://t-redactyl.io/ class=home-icon>
 <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAABH0lEQVR42u2XYQ2DMBBG6wAJk4AEJEwCUpCABCQgYTgAB0ggQQC3lpSMDdZSOtavyb3kEn7ReyHf9RCCYTAhokRWLatSz7E1f5PV0ot2T0LLfSMJ1Xwqa9hpaCMxTdPDIJCFaD4nM0oihRSQB5Z0jGGRgBBYhdWFWWIcx7ACO2F1kui6rg8mYAjrr8hChhVXwCGsWAInw4oh4BnWs9xjCauJPIaw2ijQw3qECjmsR2mtG6puviVc3pZBpLA671F7YY2h+e2EUimneCkFRY7tvxSdep48TdP0vm9Sf1cu5Xue7jlZTyC/T+l+UfqymUTFx6hCExis64VeH2p9oaEJLBtCeckBVwsItANYgAVYgAVYgAVYgAVYgAVYAFeA+RNPj8zgnGDT7N8AAAAASUVORK5CYII=">
 </a>
<article role=article class=full-single-article>
 <div class=container>
 <div class=row>
 <div class="col-md-8 col-md-offset-2">
 <h1>Using schemas to speed up reading into Spark&nbsp;DataFrames</h1>
 <div class=meta>
 written <time datetime=2020-08-24T00:00:00+02:00>August 24, 2020</time>
 in <span class=categories>
 <a href=https://t-redactyl.github.io/tag/pyspark.html>pyspark</a> </span>
 </div>
 <p>While Spark is the best thing since sliced bread for dealing with big data, I definitely realise I have a lot to learn before I can use it to its full potential. One trick I recently discovered was using explicit schemas to speed up how fast PySpark can read a <span class=caps>CSV</span> into a&nbsp;DataFrame.</p>
<p>When using <code>spark.read_csv</code> to read in a <span class=caps>CSV</span> in PySpark, the most straightforward way is to set the <code>inferSchema</code> argument to <code>True</code>. This means that PySpark will attempt to check the data in order to work out what type of data each column&nbsp;is. </p>
<p>The problem with this operation is that it’s quite memory intensive, especially for large datasets, as Spark needs to look at a sufficient amount of data in order to correctly infer the type. Imagine that you have a column with integers in the first 1000 rows, but then a string in the 1001th row. If PySpark had inferred this column was an <code>IntegerType</code> based on the top few rows, then we would end up with missing values for each of the rows containing a string. As such, PySpark either needs to scan the whole dataset, or randomly sample enough rows to infer the&nbsp;type.</p>
<p>One way we can get around this is by determining the type of the data beforehand and passing this information to PySpark using an schema. The syntax for this is pretty straightforward. Each column’s name and type is defined using the <code>StructField</code> method from <code>pyspark.sql</code>:</p>
<div class=highlight><pre><span></span><code><span class=n>StructField</span><span class=p>(</span><span class=s2>"trip_id"</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>)</span>
</code></pre></div>
<p>The three arguments that <code>StructField</code> takes are the name you’d like to give the column, the column’s data type, and whether the field can contain null values (as a boolean). The available column data types are also in <code>pyspark.sql</code>, and cover a wide type of possible data types, from string, float and integer to boolean and datetime. A <code>StructField</code> is created for each column, and these are passed as a list to <code>pyspark.sql</code><span class=quo>‘</span>s <code>StructType</code>. This schema can then be passed to <code>spark.read.csv</code><span class=quo>‘</span>s <code>schema</code> argument.</p>
<div class=highlight><pre><span></span><code><span class=n>StructType</span><span class=p>(</span>
    <span class=p>[</span><span class=n>StructField</span><span class=p>(</span><span class=s2>"trip_id"</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
    <span class=n>StructField</span><span class=p>(</span><span class=s2>"call_type"</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>)]</span>
<span class=p>)</span>
</code></pre></div>
<p>In order to test how much faster it is to use a schema, I will be using the <a href=https://archive.ics.uci.edu/ml/datasets/Taxi+Service+Trajectory+-+Prediction+Challenge,+ECML+PKDD+2015>Taxi Service Trajectory</a> dataset from the <span class=caps>UCI</span> Machine Learning Repository. This dataset has 9 columns and around 1.7 million&nbsp;rows.</p>
<p>We’ll first set up our <code>SparkSession</code> to be able to access our data on&nbsp;S3:</p>
<div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pyspark</span> <span class=kn>import</span> <span class=n>SparkConf</span>
<span class=kn>from</span> <span class=nn>pyspark.sql</span> <span class=kn>import</span> <span class=n>SparkSession</span>
<span class=kn>import</span> <span class=nn>sagemaker_pyspark</span>
<span class=kn>import</span> <span class=nn>botocore.session</span>

<span class=kn>from</span> <span class=nn>time</span> <span class=kn>import</span> <span class=n>time</span>
<span class=kn>from</span> <span class=nn>pyspark.sql.types</span> <span class=kn>import</span> <span class=n>StructType</span><span class=p>,</span> <span class=n>StructField</span><span class=p>,</span> <span class=n>StringType</span><span class=p>,</span> <span class=n>IntegerType</span><span class=p>,</span> <span class=n>LongType</span><span class=p>,</span> <span class=n>BooleanType</span>

<span class=n>session</span> <span class=o>=</span> <span class=n>botocore</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>get_session</span><span class=p>()</span>
<span class=n>credentials</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get_credentials</span><span class=p>()</span>

<span class=n>conf</span> <span class=o>=</span> <span class=p>(</span><span class=n>SparkConf</span><span class=p>()</span>
        <span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=s2>"spark.driver.extraClassPath"</span><span class=p>,</span> <span class=s2>":"</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>sagemaker_pyspark</span><span class=o>.</span><span class=n>classpath_jars</span><span class=p>())))</span>

<span class=n>spark</span> <span class=o>=</span> <span class=p>(</span>
    <span class=n>SparkSession</span>
    <span class=o>.</span><span class=n>builder</span>
    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=n>conf</span><span class=o>=</span><span class=n>conf</span><span class=p>)</span> \
    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s1>'fs.s3a.access.key'</span><span class=p>,</span> <span class=n>credentials</span><span class=o>.</span><span class=n>access_key</span><span class=p>)</span>
    <span class=o>.</span><span class=n>config</span><span class=p>(</span><span class=s1>'fs.s3a.secret.key'</span><span class=p>,</span> <span class=n>credentials</span><span class=o>.</span><span class=n>secret_key</span><span class=p>)</span>
    <span class=o>.</span><span class=n>appName</span><span class=p>(</span><span class=s2>"schema_test"</span><span class=p>)</span>
    <span class=o>.</span><span class=n>getOrCreate</span><span class=p>()</span>
<span class=p>)</span>
</code></pre></div>
<p>We’ll also set up our data&nbsp;path:</p>
<div class=highlight><pre><span></span><code><span class=n>bucket</span> <span class=o>=</span> <span class=s2>"sagemaker-pyspark"</span>
<span class=n>data_key</span> <span class=o>=</span> <span class=s2>"train.csv"</span>
<span class=n>data_location</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>"s3a://</span><span class=si>{</span><span class=n>bucket</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>data_key</span><span class=si>}</span><span class=s2>"</span>
</code></pre></div>
<p>Let’s first time how long it takes to read in these data when PySpark has to infer the&nbsp;schema:</p>
<div class=highlight><pre><span></span><code><span class=n>t1</span> <span class=o>=</span> <span class=n>time</span><span class=p>()</span>

<span class=n>data_inferred</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>csv</span><span class=p>(</span><span class=n>data_location</span><span class=p>,</span> <span class=n>header</span> <span class=o>=</span> <span class=s1>'True'</span><span class=p>,</span> <span class=n>inferSchema</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span>

<span class=n>t2</span> <span class=o>=</span> <span class=n>time</span><span class=p>()</span>
<span class=nb>print</span><span class=p>(</span><span class=s1>'Completed in </span><span class=si>%s</span><span class=s1> sec.'</span> <span class=o>%</span> <span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>t2</span> <span class=o>-</span> <span class=n>t1</span><span class=p>)))</span>
</code></pre></div>
<div class=highlight><pre><span></span><code><span class=err>Completed in 28.1013503074646 sec.</span>
</code></pre></div>
<p>We’ll now compare how long it takes when we explicitly tell PySpark what the data schema&nbsp;is:</p>
<div class=highlight><pre><span></span><code><span class=n>t1</span> <span class=o>=</span> <span class=n>time</span><span class=p>()</span>

<span class=n>schema</span> <span class=o>=</span> <span class=n>StructType</span><span class=p>(</span>
    <span class=p>[</span><span class=n>StructField</span><span class=p>(</span><span class=s2>"trip_id"</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
    <span class=n>StructField</span><span class=p>(</span><span class=s2>"call_type"</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
    <span class=n>StructField</span><span class=p>(</span><span class=s2>"origin_call"</span><span class=p>,</span> <span class=n>IntegerType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
    <span class=n>StructField</span><span class=p>(</span><span class=s2>"origin_stand"</span><span class=p>,</span> <span class=n>IntegerType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
    <span class=n>StructField</span><span class=p>(</span><span class=s2>"taxi_id"</span><span class=p>,</span> <span class=n>LongType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
    <span class=n>StructField</span><span class=p>(</span><span class=s2>"timestamp"</span><span class=p>,</span> <span class=n>LongType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
    <span class=n>StructField</span><span class=p>(</span><span class=s2>"day_type"</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
    <span class=n>StructField</span><span class=p>(</span><span class=s2>"missing_data"</span><span class=p>,</span> <span class=n>BooleanType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>),</span>
    <span class=n>StructField</span><span class=p>(</span><span class=s2>"polyline"</span><span class=p>,</span> <span class=n>StringType</span><span class=p>(),</span> <span class=kc>True</span><span class=p>)]</span>
<span class=p>)</span>
<span class=n>data_schema</span> <span class=o>=</span> <span class=n>spark</span><span class=o>.</span><span class=n>read</span><span class=o>.</span><span class=n>csv</span><span class=p>(</span><span class=n>data_location</span><span class=p>,</span> <span class=n>header</span> <span class=o>=</span> <span class=s1>'False'</span><span class=p>,</span> <span class=n>schema</span> <span class=o>=</span> <span class=n>schema</span><span class=p>)</span>

<span class=n>t2</span> <span class=o>=</span> <span class=n>time</span><span class=p>()</span>
<span class=nb>print</span><span class=p>(</span><span class=s1>'Completed in </span><span class=si>%s</span><span class=s1> sec.'</span> <span class=o>%</span> <span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>t2</span> <span class=o>-</span> <span class=n>t1</span><span class=p>)))</span>
</code></pre></div>
<div class=highlight><pre><span></span><code><span class=err>Completed in 2.506075620651245 sec.</span>
</code></pre></div>
<p>The data are read in around 10 times faster when we give PySpark the schema rather than asking it to infer it! Obviously this is a more practical step when you have data with fewer variables, but when reading truly large data, it is an easy way to save some processing&nbsp;time.</p>
 <hr class=divider-short>
 
 
 </div>
 </div>
 </div>
</article>
 <footer id=footer class=her-row>
 <div class=container>
 <div class=row>
 <div class=col-md-1>
 <a href=https://t-redactyl.io/><h4>Home</h4></a>
 </div>
 <div class=col-md-2>
 <div class=social-icon-list>
 <a href=https://twitter.com/t_redactyl><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA/JpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ1dWlkOjY1RTYzOTA2ODZDRjExREJBNkUyRDg4N0NFQUNCNDA3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkVBMkY0MUMzREIxNDExRTI5OUM3RjkzMzA0MzZGNDcwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkVBMkY0MUMyREIxNDExRTI5OUM3RjkzMzA0MzZGNDcwIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzYgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo2Zjc5YzE4Yy02NmMwLTQ5OWItOTc2Yy04MWVhNmRhNGUwMjkiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MzQzRTBDQzgwNzIwNjgxMTgwODM4NkU1NzNGNzFDMzYiLz4gPGRjOnRpdGxlPiA8cmRmOkFsdD4gPHJkZjpsaSB4bWw6bGFuZz0ieC1kZWZhdWx0Ij5nbHlwaGljb25zPC9yZGY6bGk+IDwvcmRmOkFsdD4gPC9kYzp0aXRsZT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4y+amzAAAA/klEQVR42txW3RGCMAwOnu+yAYzACN1ER2AER2CEuoFu0BE6Qt1AJqipl95x0J8U7Yu5++4KTfI1SUMAABCIF8L+GM6naGhxgjoyN8RWTQ5QWaoTHL+wfSA0okecU4rr6uvMrfrcDmsteKAMiImw1t+8GMkgRnJdOl+QuEgkwiz1gzVAAx/6LbB9j9gYWna5FKnAyVxUik4nQhGQruWkSMXSkAOXYK9zwSVwxR12EExcAk9yQbQFBKaUoC9wPib6JrohORFkeiZJ4COZEs5b6ny7h8AZjplbYxiDJ+h4yKREcidbauA8iUzTs6Cu7ko+uf8x0eaK/meo/dvyFmAARBcTCpL4jVwAAAAASUVORK5CYII="></a>
 <a href=https://github.com/t-redactyl><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA/JpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ1dWlkOjY1RTYzOTA2ODZDRjExREJBNkUyRDg4N0NFQUNCNDA3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkQ1NTREOUJFREIxNDExRTI5OUM3RjkzMzA0MzZGNDcwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkQwRUM5ODA4REIxNDExRTI5OUM3RjkzMzA0MzZGNDcwIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzYgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo2Zjc5YzE4Yy02NmMwLTQ5OWItOTc2Yy04MWVhNmRhNGUwMjkiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MzQzRTBDQzgwNzIwNjgxMTgwODM4NkU1NzNGNzFDMzYiLz4gPGRjOnRpdGxlPiA8cmRmOkFsdD4gPHJkZjpsaSB4bWw6bGFuZz0ieC1kZWZhdWx0Ij5nbHlwaGljb25zPC9yZGY6bGk+IDwvcmRmOkFsdD4gPC9kYzp0aXRsZT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5XSIMHAAAAvklEQVR42mJgYGAIAOIPQPyfyhhkZgAjlMHPQBvwkRFqG80AEwONwYBZkAjED0kw5yFUD1aAkQKAAESA5BKA+AGelAKSS0BSj6EGayQDFTOSExyMjIz/B0UcPKTAvIPExAE8TEnF0FIBxTxsPnhAgQ8+EPQBkmsaSCh3GqB6BLDIYQgYICvElQTRxaFsB2KCyICCIFIgJpIfkOMDqJ4HxAQRCC8gkMOJ1jNaXI8QCz7S0PyPsNxHq2aLA0CAAQDnhQMbm3hE3wAAAABJRU5ErkJggg=="></a>
 </div>
 </div>
 <div class=pull-right>
 <h4>
 Powered by <a href=http://blog.getpelican.com/>Pelican</a>.
 Designed by <a href=http://adrianartiles.com/>Adrian Artiles</a>.
 Title picture by
 <a href=https://pixabay.com/en/brandenburg-gate-berlin-landmark-2010656/>Couleur via Pixabay</a>.
 </h4>
 </div>
 </div>
 </div>
 </footer>
 
 
 
